{"version":3,"sources":["webpack://wb-positioning-jssdk/webpack/universalModuleDefinition","webpack://wb-positioning-jssdk/webpack/bootstrap","webpack://wb-positioning-jssdk/./node_modules/weixin-js-sdk/index.js","webpack://wb-positioning-jssdk/./src/bluetooth/index.js","webpack://wb-positioning-jssdk/./src/gps/index.js","webpack://wb-positioning-jssdk/./src/index.js","webpack://wb-positioning-jssdk/./src/loc.js"],"names":["INTERVAL","POINTLENTH","CHANGE_GPS","blueToothFn","target","signUrl","getIbeconUrl","phoneType","ibeaconArr","gpsTimeId","ua","navigator","userAgent","toLowerCase","test","signBody","encodeURIComponent","window","location","href","split","mapId","onunload","stopSearchBeacons","fetch","method","headers","body","then","response","json","data","configWx","initIbeacon","initSuccess","catch","err","initError","sign","config","debug","appId","appid","timestamp","nonceStr","signature","beta","jsApiList","error","res","complete","console","log","stopLocationComplete","code","msg","ready","time","flag","timeId","addEventListener","Date","now","searchIbeacon","fail","clearTimeout","setTimeout","initGps","onSearchBeaconsWithGps","startSearchBeacons","ticket","t","startSuccess","errMsg","n","startLocationError","onSearchBeacons","getIbeaconPoints","beacons","filter","v","rssi","length","currentLocation","filterData","map","Number","device","major","minor","JSON","stringify","getIbeaconBody","Polygon","setPolygonLocation","ibeaconObj","isOutdoor","longitude","lon","latitude","lat","buildingId","building","level","fiducialLat","fiducialLon","locType","timer","getTime","onSuccessIbeacon","push","polygonLon","polygonLat","inputArr","i","polygonLocation","polygonV2","shift","points","m","x","y","gpsFn","coords","gpsObj","accuracy","onSuccessGps","gps","gpsWatchId","geolocation","watchPosition","geo_success","geo_error","enableHighAccuracy","timeout","clearWatch","Loc","initComplete","includes","getSignature","startLocationComplete","startGpsSearch","startIbeaconSearch","stopGpsSearch","stopIbeaconSearch","onLocationComplete","gpsCoords","currentPosition","ibeaconCoords"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,kDAA0C,gCAAgC;AAC1E;AACA;;AAEA;AACA;AACA;AACA,gEAAwD,kBAAkB;AAC1E;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAyC,iCAAiC;AAC1E,wHAAgH,mBAAmB,EAAE;AACrI;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;AClFA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,sBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,OAAO;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,UAAU;AACV;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,2BAA2B,OAAO;AAClC;AACA,aAAa;AACb;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA,yBAAyB,OAAO;AAChC;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA,2BAA2B;AAC3B;AACA,OAAO;AACP;AACA,0BAA0B;AAC1B;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,SAAS;AACT;AACA,OAAO;AACP,iCAAiC;AACjC;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP,oCAAoC;AACpC;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA,mBAAmB;AACnB;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA,8BAA8B;AAC9B;AACA,OAAO;AACP;AACA,8BAA8B;AAC9B;AACA,OAAO;AACP;AACA,2BAA2B;AAC3B,mBAAmB;AACnB,OAAO;AACP;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA,sCAAsC;AACtC;AACA,OAAO;AACP;AACA,sCAAsC;AACtC;AACA,OAAO;AACP;AACA;AACA,kCAAkC;AAClC;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA,2BAA2B;AAC3B;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA,oCAAoC,OAAO;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,2CAA2C,OAAO;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA,oCAAoC,OAAO;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA,iCAAiC;AACjC;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,OAAO;AACP;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,CAAC,E;;;;;;;;;;;;;;;;;;;AC9yBD;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,WAAW,GAAjB,C,CAAsB;;AACtB,IAAMC,aAAa,CAAnB,C,CAAsB;;AACtB,IAAMC,aAAa,IAAnB,C,CAAyB;;AAEzB,IAAMC,cAAc,SAAdA,WAAc,CAACC,MAAD,EAAY;AAC5B;AACA,MAAMC,gEAAN,CAF4B,CAG5B;;AACA,MAAMC,mEAAN,CAJ4B,CAI8C;AAC1E;AACA;AAEA;;AACA,MAAIC,YAAY,KAAhB;AACA,MAAIC,aAAa,EAAjB,CAV4B,CAUP;;AACrB,MAAIC,YAAY,IAAhB,CAX4B,CAWN;;AACtB,MAAMC,KAAKC,UAAUC,SAAV,CAAoBC,WAApB,EAA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","file":"wb-positioning-jssdk.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"wb-positioning-jssdk\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"wb-positioning-jssdk\"] = factory();\n\telse\n\t\troot[\"wb-positioning-jssdk\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","! function (e, n) {\n  module.exports = n(e)\n}(window, function (e, n) {\n  function i(n, i, t) {\n    e.WeixinJSBridge ? WeixinJSBridge.invoke(n, o(i),\n    function(e) {\n      c(n, e, t)\n    }) : u(n, t)\n  }\n  function t(n, i, t) {\n    e.WeixinJSBridge ? WeixinJSBridge.on(n,\n    function(e) {\n      t && t.trigger && t.trigger(e),\n      c(n, e, i)\n    }) : t ? u(n, t) : u(n, i)\n  }\n  function o(e) {\n    return e = e || {},\n    e.appId = C.appId,\n    e.verifyAppId = C.appId,\n    e.verifySignType = \"sha1\",\n    e.verifyTimestamp = C.timestamp + \"\",\n    e.verifyNonceStr = C.nonceStr,\n    e.verifySignature = C.signature,\n    e\n  }\n  function r(e) {\n    return {\n      timeStamp: e.timestamp + \"\",\n      nonceStr: e.nonceStr,\n      package: e.package,\n      paySign: e.paySign,\n      signType: e.signType || \"SHA1\"\n    }\n  }\n  function a(e) {\n    return e.postalCode = e.addressPostalCode,\n    delete e.addressPostalCode,\n    e.provinceName = e.proviceFirstStageName,\n    delete e.proviceFirstStageName,\n    e.cityName = e.addressCitySecondStageName,\n    delete e.addressCitySecondStageName,\n    e.countryName = e.addressCountiesThirdStageName,\n    delete e.addressCountiesThirdStageName,\n    e.detailInfo = e.addressDetailInfo,\n    delete e.addressDetailInfo,\n    e\n  }\n  function c(e, n, i) {\n    \"openEnterpriseChat\" == e && (n.errCode = n.err_code),\n    delete n.err_code,\n    delete n.err_desc,\n    delete n.err_detail;\n    var t = n.errMsg;\n    t || (t = n.err_msg, delete n.err_msg, t = s(e, t), n.errMsg = t),\n    (i = i || {})._complete && (i._complete(n), delete i._complete),\n    t = n.errMsg || \"\",\n    C.debug && !i.isInnerInvoke && alert(JSON.stringify(n));\n    var o = t.indexOf(\":\");\n    switch (t.substring(o + 1)) {\n    case \"ok\":\n      i.success && i.success(n);\n      break;\n    case \"cancel\":\n      i.cancel && i.cancel(n);\n      break;\n    default:\n      i.fail && i.fail(n)\n    }\n    i.complete && i.complete(n)\n  }\n  function s(e, n) {\n    var i = e,\n    t = v[i];\n    t && (i = t);\n    var o = \"ok\";\n    if (n) {\n      var r = n.indexOf(\":\");\n      \"confirm\" == (o = n.substring(r + 1)) && (o = \"ok\"),\n      \"failed\" == o && (o = \"fail\"),\n      -1 != o.indexOf(\"failed_\") && (o = o.substring(7)),\n      -1 != o.indexOf(\"fail_\") && (o = o.substring(5)),\n      \"access denied\" != (o = (o = o.replace(/_/g, \" \")).toLowerCase()) && \"no permission to execute\" != o || (o = \"permission denied\"),\n      \"config\" == i && \"function not exist\" == o && (o = \"ok\"),\n      \"\" == o && (o = \"fail\")\n    }\n    return n = i + \":\" + o\n  }\n  function d(e) {\n    if (e) {\n      for (var n = 0,\n      i = e.length; n < i; ++n) {\n        var t = e[n],\n        o = h[t];\n        o && (e[n] = o)\n      }\n      return e\n    }\n  }\n  function u(e, n) {\n    if (! (!C.debug || n && n.isInnerInvoke)) {\n      var i = v[e];\n      i && (e = i),\n      n && n._complete && delete n._complete,\n      console.log('\"' + e + '\",', n || \"\")\n    }\n  }\n  function l(e) {\n    if (! (k || w || C.debug || x < \"6.0.2\" || V.systemType < 0)) {\n      var n = new Image;\n      V.appId = C.appId,\n      V.initTime = A.initEndTime - A.initStartTime,\n      V.preVerifyTime = A.preVerifyEndTime - A.preVerifyStartTime,\n      N.getNetworkType({\n        isInnerInvoke: !0,\n        success: function(e) {\n          V.networkType = e.networkType;\n          var i = \"https://open.weixin.qq.com/sdk/report?v=\" + V.version + \"&o=\" + V.isPreVerifyOk + \"&s=\" + V.systemType + \"&c=\" + V.clientVersion + \"&a=\" + V.appId + \"&n=\" + V.networkType + \"&i=\" + V.initTime + \"&p=\" + V.preVerifyTime + \"&u=\" + V.url;\n          n.src = i\n        }\n      })\n    }\n  }\n  function p() {\n    return (new Date).getTime()\n  }\n  function f(n) {\n    T && (e.WeixinJSBridge ? n() : S.addEventListener && S.addEventListener(\"WeixinJSBridgeReady\", n, !1))\n  }\n  function m() {\n    N.invoke || (N.invoke = function(n, i, t) {\n      e.WeixinJSBridge && WeixinJSBridge.invoke(n, o(i), t)\n    },\n    N.on = function(n, i) {\n      e.WeixinJSBridge && WeixinJSBridge.on(n, i)\n    })\n  }\n  function g(e) {\n    if (\"string\" == typeof e && e.length > 0) {\n      var n = e.split(\"?\")[0],\n      i = e.split(\"?\")[1];\n      return n += \".html\",\n      void 0 !== i ? n + \"?\" + i: n\n    }\n  }\n  if (!e.jWeixin) {\n    var h = {\n      config: \"preVerifyJSAPI\",\n      onMenuShareTimeline: \"menu:share:timeline\",\n      onMenuShareAppMessage: \"menu:share:appmessage\",\n      onMenuShareQQ: \"menu:share:qq\",\n      onMenuShareWeibo: \"menu:share:weiboApp\",\n      onMenuShareQZone: \"menu:share:QZone\",\n      previewImage: \"imagePreview\",\n      getLocation: \"geoLocation\",\n      openProductSpecificView: \"openProductViewWithPid\",\n      addCard: \"batchAddCard\",\n      openCard: \"batchViewCard\",\n      chooseWXPay: \"getBrandWCPayRequest\",\n      openEnterpriseRedPacket: \"getRecevieBizHongBaoRequest\",\n      startSearchBeacons: \"startMonitoringBeacons\",\n      stopSearchBeacons: \"stopMonitoringBeacons\",\n      onSearchBeacons: \"onBeaconsInRange\",\n      consumeAndShareCard: \"consumedShareCard\",\n      openAddress: \"editAddress\"\n    },\n    v = function() {\n      var e = {};\n      for (var n in h) e[h[n]] = n;\n      return e\n    } (),\n    S = e.document,\n    I = S.title,\n    y = navigator.userAgent.toLowerCase(),\n    _ = navigator.platform.toLowerCase(),\n    k = !(!_.match(\"mac\") && !_.match(\"win\")),\n    w = -1 != y.indexOf(\"wxdebugger\"),\n    T = -1 != y.indexOf(\"micromessenger\"),\n    M = -1 != y.indexOf(\"android\"),\n    P = -1 != y.indexOf(\"iphone\") || -1 != y.indexOf(\"ipad\"),\n    x = function() {\n      var e = y.match(/micromessenger\\/(\\d+\\.\\d+\\.\\d+)/) || y.match(/micromessenger\\/(\\d+\\.\\d+)/);\n      return e ? e[1] : \"\"\n    } (),\n    A = {\n      initStartTime: p(),\n      initEndTime: 0,\n      preVerifyStartTime: 0,\n      preVerifyEndTime: 0\n    },\n    V = {\n      version: 1,\n      appId: \"\",\n      initTime: 0,\n      preVerifyTime: 0,\n      networkType: \"\",\n      isPreVerifyOk: 1,\n      systemType: P ? 1 : M ? 2 : -1,\n      clientVersion: x,\n      url: encodeURIComponent(location.href)\n    },\n    C = {},\n    L = {\n      _completes: []\n    },\n    B = {\n      state: 0,\n      data: {}\n    };\n    f(function() {\n      A.initEndTime = p()\n    });\n    var O = !1,\n    E = [],\n    N = {\n      config: function(e) {\n        C = e,\n        u(\"config\", e);\n        var n = !1 !== C.check;\n        f(function() {\n          if (n) i(h.config, {\n            verifyJsApiList: d(C.jsApiList)\n          },\n          function() {\n            L._complete = function(e) {\n              A.preVerifyEndTime = p(),\n              B.state = 1,\n              B.data = e\n            },\n            L.success = function(e) {\n              V.isPreVerifyOk = 0\n            },\n            L.fail = function(e) {\n              L._fail ? L._fail(e) : B.state = -1\n            };\n            var e = L._completes;\n            return e.push(function() {\n              l()\n            }),\n            L.complete = function(n) {\n              for (var i = 0,\n              t = e.length; i < t; ++i) e[i]();\n              L._completes = []\n            },\n            L\n          } ()),\n          A.preVerifyStartTime = p();\n          else {\n            B.state = 1;\n            for (var e = L._completes,\n            t = 0,\n            o = e.length; t < o; ++t) e[t]();\n            L._completes = []\n          }\n        }),\n        m()\n      },\n      ready: function(e) {\n        0 != B.state ? e() : (L._completes.push(e), !T && C.debug && e())\n      },\n      error: function(e) {\n        x < \"6.0.2\" || ( - 1 == B.state ? e(B.data) : L._fail = e)\n      },\n      checkJsApi: function(e) {\n        var n = function(e) {\n          var n = e.checkResult;\n          for (var i in n) {\n            var t = v[i];\n            t && (n[t] = n[i], delete n[i])\n          }\n          return e\n        };\n        i(\"checkJsApi\", {\n          jsApiList: d(e.jsApiList)\n        },\n        (e._complete = function(e) {\n          if (M) {\n            var i = e.checkResult;\n            i && (e.checkResult = JSON.parse(i))\n          }\n          e = n(e)\n        },\n        e))\n      },\n      onMenuShareTimeline: function(e) {\n        t(h.onMenuShareTimeline, {\n          complete: function() {\n            i(\"shareTimeline\", {\n              title: e.title || I,\n              desc: e.title || I,\n              img_url: e.imgUrl || \"\",\n              link: e.link || location.href,\n              type: e.type || \"link\",\n              data_url: e.dataUrl || \"\"\n            },\n            e)\n          }\n        },\n        e)\n      },\n      onMenuShareAppMessage: function(e) {\n        t(h.onMenuShareAppMessage, {\n          complete: function(n) {\n            \"favorite\" === n.scene ? i(\"sendAppMessage\", {\n              title: e.title || I,\n              desc: e.desc || \"\",\n              link: e.link || location.href,\n              img_url: e.imgUrl || \"\",\n              type: e.type || \"link\",\n              data_url: e.dataUrl || \"\"\n            }) : i(\"sendAppMessage\", {\n              title: e.title || I,\n              desc: e.desc || \"\",\n              link: e.link || location.href,\n              img_url: e.imgUrl || \"\",\n              type: e.type || \"link\",\n              data_url: e.dataUrl || \"\"\n            },\n            e)\n          }\n        },\n        e)\n      },\n      onMenuShareQQ: function(e) {\n        t(h.onMenuShareQQ, {\n          complete: function() {\n            i(\"shareQQ\", {\n              title: e.title || I,\n              desc: e.desc || \"\",\n              img_url: e.imgUrl || \"\",\n              link: e.link || location.href\n            },\n            e)\n          }\n        },\n        e)\n      },\n      onMenuShareWeibo: function(e) {\n        t(h.onMenuShareWeibo, {\n          complete: function() {\n            i(\"shareWeiboApp\", {\n              title: e.title || I,\n              desc: e.desc || \"\",\n              img_url: e.imgUrl || \"\",\n              link: e.link || location.href\n            },\n            e)\n          }\n        },\n        e)\n      },\n      onMenuShareQZone: function(e) {\n        t(h.onMenuShareQZone, {\n          complete: function() {\n            i(\"shareQZone\", {\n              title: e.title || I,\n              desc: e.desc || \"\",\n              img_url: e.imgUrl || \"\",\n              link: e.link || location.href\n            },\n            e)\n          }\n        },\n        e)\n      },\n      updateTimelineShareData: function(e) {\n        i(\"updateTimelineShareData\", {\n          title: e.title,\n          link: e.link,\n          imgUrl: e.imgUrl\n        },\n        e)\n      },\n      updateAppMessageShareData: function(e) {\n        i(\"updateAppMessageShareData\", {\n          title: e.title,\n          desc: e.desc,\n          link: e.link,\n          imgUrl: e.imgUrl\n        },\n        e)\n      },\n      startRecord: function(e) {\n        i(\"startRecord\", {},\n        e)\n      },\n      stopRecord: function(e) {\n        i(\"stopRecord\", {},\n        e)\n      },\n      onVoiceRecordEnd: function(e) {\n        t(\"onVoiceRecordEnd\", e)\n      },\n      playVoice: function(e) {\n        i(\"playVoice\", {\n          localId: e.localId\n        },\n        e)\n      },\n      pauseVoice: function(e) {\n        i(\"pauseVoice\", {\n          localId: e.localId\n        },\n        e)\n      },\n      stopVoice: function(e) {\n        i(\"stopVoice\", {\n          localId: e.localId\n        },\n        e)\n      },\n      onVoicePlayEnd: function(e) {\n        t(\"onVoicePlayEnd\", e)\n      },\n      uploadVoice: function(e) {\n        i(\"uploadVoice\", {\n          localId: e.localId,\n          isShowProgressTips: 0 == e.isShowProgressTips ? 0 : 1\n        },\n        e)\n      },\n      downloadVoice: function(e) {\n        i(\"downloadVoice\", {\n          serverId: e.serverId,\n          isShowProgressTips: 0 == e.isShowProgressTips ? 0 : 1\n        },\n        e)\n      },\n      translateVoice: function(e) {\n        i(\"translateVoice\", {\n          localId: e.localId,\n          isShowProgressTips: 0 == e.isShowProgressTips ? 0 : 1\n        },\n        e)\n      },\n      chooseImage: function(e) {\n        i(\"chooseImage\", {\n          scene: \"1|2\",\n          count: e.count || 9,\n          sizeType: e.sizeType || [\"original\", \"compressed\"],\n          sourceType: e.sourceType || [\"album\", \"camera\"]\n        },\n        (e._complete = function(e) {\n          if (M) {\n            var n = e.localIds;\n            try {\n              n && (e.localIds = JSON.parse(n))\n            } catch(e) {}\n          }\n        },\n        e))\n      },\n      getLocation: function(e) {},\n      previewImage: function(e) {\n        i(h.previewImage, {\n          current: e.current,\n          urls: e.urls\n        },\n        e)\n      },\n      uploadImage: function(e) {\n        i(\"uploadImage\", {\n          localId: e.localId,\n          isShowProgressTips: 0 == e.isShowProgressTips ? 0 : 1\n        },\n        e)\n      },\n      downloadImage: function(e) {\n        i(\"downloadImage\", {\n          serverId: e.serverId,\n          isShowProgressTips: 0 == e.isShowProgressTips ? 0 : 1\n        },\n        e)\n      },\n      getLocalImgData: function(e) { ! 1 === O ? (O = !0, i(\"getLocalImgData\", {\n          localId: e.localId\n        },\n        (e._complete = function(e) {\n          if (O = !1, E.length > 0) {\n            var n = E.shift();\n            wx.getLocalImgData(n)\n          }\n        },\n        e))) : E.push(e)\n      },\n      getNetworkType: function(e) {\n        var n = function(e) {\n          var n = e.errMsg;\n          e.errMsg = \"getNetworkType:ok\";\n          var i = e.subtype;\n          if (delete e.subtype, i) e.networkType = i;\n          else {\n            var t = n.indexOf(\":\"),\n            o = n.substring(t + 1);\n            switch (o) {\n            case \"wifi\":\n            case \"edge\":\n            case \"wwan\":\n              e.networkType = o;\n              break;\n            default:\n              e.errMsg = \"getNetworkType:fail\"\n            }\n          }\n          return e\n        };\n        i(\"getNetworkType\", {},\n        (e._complete = function(e) {\n          e = n(e)\n        },\n        e))\n      },\n      openLocation: function(e) {\n        i(\"openLocation\", {\n          latitude: e.latitude,\n          longitude: e.longitude,\n          name: e.name || \"\",\n          address: e.address || \"\",\n          scale: e.scale || 28,\n          infoUrl: e.infoUrl || \"\"\n        },\n        e)\n      },\n      getLocation: function(e) {\n        e = e || {},\n        i(h.getLocation, {\n          type: e.type || \"wgs84\"\n        },\n        (e._complete = function(e) {\n          delete e.type\n        },\n        e))\n      },\n      hideOptionMenu: function(e) {\n        i(\"hideOptionMenu\", {},\n        e)\n      },\n      showOptionMenu: function(e) {\n        i(\"showOptionMenu\", {},\n        e)\n      },\n      closeWindow: function(e) {\n        i(\"closeWindow\", {},\n        e = e || {})\n      },\n      hideMenuItems: function(e) {\n        i(\"hideMenuItems\", {\n          menuList: e.menuList\n        },\n        e)\n      },\n      showMenuItems: function(e) {\n        i(\"showMenuItems\", {\n          menuList: e.menuList\n        },\n        e)\n      },\n      hideAllNonBaseMenuItem: function(e) {\n        i(\"hideAllNonBaseMenuItem\", {},\n        e)\n      },\n      showAllNonBaseMenuItem: function(e) {\n        i(\"showAllNonBaseMenuItem\", {},\n        e)\n      },\n      scanQRCode: function(e) {\n        i(\"scanQRCode\", {\n          needResult: (e = e || {}).needResult || 0,\n          scanType: e.scanType || [\"qrCode\", \"barCode\"]\n        },\n        (e._complete = function(e) {\n          if (P) {\n            var n = e.resultStr;\n            if (n) {\n              var i = JSON.parse(n);\n              e.resultStr = i && i.scan_code && i.scan_code.scan_result\n            }\n          }\n        },\n        e))\n      },\n      openAddress: function(e) {\n        i(h.openAddress, {},\n        (e._complete = function(e) {\n          e = a(e)\n        },\n        e))\n      },\n      openProductSpecificView: function(e) {\n        i(h.openProductSpecificView, {\n          pid: e.productId,\n          view_type: e.viewType || 0,\n          ext_info: e.extInfo\n        },\n        e)\n      },\n      addCard: function(e) {\n        for (var n = e.cardList,\n        t = [], o = 0, r = n.length; o < r; ++o) {\n          var a = n[o],\n          c = {\n            card_id: a.cardId,\n            card_ext: a.cardExt\n          };\n          t.push(c)\n        }\n        i(h.addCard, {\n          card_list: t\n        },\n        (e._complete = function(e) {\n          var n = e.card_list;\n          if (n) {\n            for (var i = 0,\n            t = (n = JSON.parse(n)).length; i < t; ++i) {\n              var o = n[i];\n              o.cardId = o.card_id,\n              o.cardExt = o.card_ext,\n              o.isSuccess = !!o.is_succ,\n              delete o.card_id,\n              delete o.card_ext,\n              delete o.is_succ\n            }\n            e.cardList = n,\n            delete e.card_list\n          }\n        },\n        e))\n      },\n      chooseCard: function(e) {\n        i(\"chooseCard\", {\n          app_id: C.appId,\n          location_id: e.shopId || \"\",\n          sign_type: e.signType || \"SHA1\",\n          card_id: e.cardId || \"\",\n          card_type: e.cardType || \"\",\n          card_sign: e.cardSign,\n          time_stamp: e.timestamp + \"\",\n          nonce_str: e.nonceStr\n        },\n        (e._complete = function(e) {\n          e.cardList = e.choose_card_info,\n          delete e.choose_card_info\n        },\n        e))\n      },\n      openCard: function(e) {\n        for (var n = e.cardList,\n        t = [], o = 0, r = n.length; o < r; ++o) {\n          var a = n[o],\n          c = {\n            card_id: a.cardId,\n            code: a.code\n          };\n          t.push(c)\n        }\n        i(h.openCard, {\n          card_list: t\n        },\n        e)\n      },\n      consumeAndShareCard: function(e) {\n        i(h.consumeAndShareCard, {\n          consumedCardId: e.cardId,\n          consumedCode: e.code\n        },\n        e)\n      },\n      chooseWXPay: function(e) {\n        i(h.chooseWXPay, r(e), e)\n      },\n      openEnterpriseRedPacket: function(e) {\n        i(h.openEnterpriseRedPacket, r(e), e)\n      },\n      startSearchBeacons: function(e) {\n        i(h.startSearchBeacons, {\n          ticket: e.ticket\n        },\n        e)\n      },\n      stopSearchBeacons: function(e) {\n        i(h.stopSearchBeacons, {},\n        e)\n      },\n      onSearchBeacons: function(e) {\n        t(h.onSearchBeacons, e)\n      },\n      openEnterpriseChat: function(e) {\n        i(\"openEnterpriseChat\", {\n          useridlist: e.userIds,\n          chatname: e.groupName\n        },\n        e)\n      },\n      launchMiniProgram: function(e) {\n        i(\"launchMiniProgram\", {\n          targetAppId: e.targetAppId,\n          path: g(e.path),\n          envVersion: e.envVersion\n        },\n        e)\n      },\n      miniProgram: {\n        navigateBack: function(e) {\n          e = e || {},\n          f(function() {\n            i(\"invokeMiniProgramAPI\", {\n              name: \"navigateBack\",\n              arg: {\n                delta: e.delta || 1\n              }\n            },\n            e)\n          })\n        },\n        navigateTo: function(e) {\n          f(function() {\n            i(\"invokeMiniProgramAPI\", {\n              name: \"navigateTo\",\n              arg: {\n                url: e.url\n              }\n            },\n            e)\n          })\n        },\n        redirectTo: function(e) {\n          f(function() {\n            i(\"invokeMiniProgramAPI\", {\n              name: \"redirectTo\",\n              arg: {\n                url: e.url\n              }\n            },\n            e)\n          })\n        },\n        switchTab: function(e) {\n          f(function() {\n            i(\"invokeMiniProgramAPI\", {\n              name: \"switchTab\",\n              arg: {\n                url: e.url\n              }\n            },\n            e)\n          })\n        },\n        reLaunch: function(e) {\n          f(function() {\n            i(\"invokeMiniProgramAPI\", {\n              name: \"reLaunch\",\n              arg: {\n                url: e.url\n              }\n            },\n            e)\n          })\n        },\n        postMessage: function(e) {\n          f(function() {\n            i(\"invokeMiniProgramAPI\", {\n              name: \"postMessage\",\n              arg: e.data || {}\n            },\n            e)\n          })\n        },\n        getEnv: function(n) {\n          f(function() {\n            n({\n              miniprogram: \"miniprogram\" === e.__wxjs_environment\n            })\n          })\n        }\n      }\n    },\n    b = 1,\n    R = {};\n    return S.addEventListener(\"error\",\n    function(e) {\n      if (!M) {\n        var n = e.target,\n        i = n.tagName,\n        t = n.src;\n        if ((\"IMG\" == i || \"VIDEO\" == i || \"AUDIO\" == i || \"SOURCE\" == i) && -1 != t.indexOf(\"wxlocalresource://\")) {\n          e.preventDefault(),\n          e.stopPropagation();\n          var o = n[\"wx-id\"];\n          if (o || (o = b++, n[\"wx-id\"] = o), R[o]) return;\n          R[o] = !0,\n          wx.ready(function() {\n            wx.getLocalImgData({\n              localId: t,\n              success: function(e) {\n                n.src = e.localData\n              }\n            })\n          })\n        }\n      }\n    },\n    !0),\n    S.addEventListener(\"load\",\n    function(e) {\n      if (!M) {\n        var n = e.target,\n        i = n.tagName;\n        n.src;\n        if (\"IMG\" == i || \"VIDEO\" == i || \"AUDIO\" == i || \"SOURCE\" == i) {\n          var t = n[\"wx-id\"];\n          t && (R[t] = !1)\n        }\n      }\n    },\n    !0),\n    n && (e.wx = e.jWeixin = N),\n    N\n  }\n});","/**\r\n * Created by j_bleach on 2018/10/16 0016.\r\n */\r\n\r\nimport wx from \"weixin-js-sdk\";\r\n\r\nconst INTERVAL = 500; // 服务器时间间隔\r\nconst POINTLENTH = 3; // 质心点计算数组长度\r\nconst CHANGE_GPS = 5000; // 搜索不到蓝牙5000ms后，切换gps\r\n\r\nconst blueToothFn = (target) => {\r\n    // const signUrl = `https://gisgd.scu.edu.cn/wxConfig/weixin/v1/jsSdkSign`;\r\n    const signUrl = `https://xz.parkbobo.com/wxConfig/weixin/v1/jsSdkSign`;\r\n    // const signUrl = `https://gisapp.swun.edu.cn/wxConfig/weixin/v1/jsSdkSign`;\r\n    const getIbeconUrl = `https://map.parkbobo.com/location/weka/v1/classify`;// map\r\n    // const getIbeconUrl = `https://gismp.scu.edu.cn/location/weka/v1/classify`;// map\r\n    // const getIbeconUrl = `https://gl.swun.edu.cn/location/weka/v1/classify`;\r\n\r\n    // const deviceUrl = `https://xz.parkbobo.com/location/device/v1/getAll`;\r\n    let phoneType = \"ios\";\r\n    let ibeaconArr = []; // 蓝牙地位点集合\r\n    let gpsTimeId = null; // gps定时器标记\r\n    const ua = navigator.userAgent.toLowerCase();\r\n    if (/iphone|ipad|ipod/.test(ua)) {\r\n        phoneType = `ios`;\r\n    } else if (/android/.test(ua)) {\r\n        phoneType = `android`;\r\n    }\r\n    return class bluetooth extends target {\r\n        constructor() {\r\n            super();\r\n        }\r\n\r\n        getSignature() {\r\n            const signBody = `url=${encodeURIComponent(window.location.href.split(\"#\")[0])}&mapId=${this.mapId}`;\r\n            // const deviceBody = `mapId=${this.mapId}&isElevator=1`;\r\n            // 注销页面，停止微信\r\n            window.onunload = () => {\r\n                wx.stopSearchBeacons();\r\n            };\r\n            // 请求签名\r\n            fetch(signUrl, {\r\n                method: \"POST\",\r\n                headers: {\r\n                    \"Content-Type\": \"application/x-www-form-urlencoded\"\r\n                },\r\n                body: signBody\r\n            }).then((response) => response.json()).then((data) => {\r\n\r\n                this.configWx(data.data);\r\n                this.initIbeacon = true;\r\n                this.initSuccess();\r\n            }).catch((err) => {\r\n                this.initError(err);\r\n            });\r\n\r\n            // fetch(deviceUrl, {\r\n            //     method: \"PUT\",\r\n            //     headers: {\r\n            //         \"Content-Type\": \"application/x-www-form-urlencoded\",\r\n            //     },\r\n            //     body: deviceBody\r\n            // }).then((response) => response.json()).then((data) => {\r\n            //     const arr = data.data;\r\n            //     this.elevators = arr && arr.map(v => v.device);\r\n            // }).catch((err) => {\r\n            //     this.initError(err);\r\n            // });\r\n        }\r\n\r\n        // 配置微信\r\n        configWx(sign) {\r\n            wx.config({\r\n                debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。\r\n                appId: sign.appid, // 必填，公众号的唯一标识\r\n                timestamp: sign.timestamp, // 必填，生成签名的时间戳\r\n                nonceStr: sign.nonceStr, // 必填，生成签名的随机串\r\n                signature: sign.signature,// 必填，签名\r\n                beta: true,   //用于在页面加载之初调用JSAPI\r\n                jsApiList: [\"openWXDeviceLib\", \"closeWXDeviceLib\",\r\n                    \"onWXDeviceBluetoothStateChange\", \"startSearchBeacons\",\r\n                    \"stopSearchBeacons\", \"onSearchBeacons\", \"startRecord\", \"stopRecord\",\r\n                    \"translateVoice\", \"onMenuShareAppMessage\", \"getLocation\",\r\n                    \"openBluetoothAdapter\", \"onWXDeviceBluetoothStateChange\", \"getBluetoothAdapterState\"] // 必填，需要使用的JS接口列表\r\n            });\r\n            wx.error((res) => {\r\n                this.initError(res);\r\n            });\r\n        }\r\n\r\n        stopIbeaconSearch() {\r\n            wx.stopSearchBeacons({\r\n                complete: () => {\r\n                    console.log(\"停止蓝牙\");\r\n                    this.stopLocationComplete({code: 0, msg: \"蓝牙停止\"});\r\n                }\r\n            });\r\n        }\r\n\r\n        /**\r\n         * @author j_bleach\r\n         * @date 2018-10-16\r\n         * @Description: 开始搜索\r\n         */\r\n        startIbeaconSearch() {\r\n            console.log(\"进入蓝牙\");\r\n            wx.ready(() => {\r\n                let time = 0;\r\n                let flag = false;\r\n                let timeId = void 0;\r\n                window.addEventListener(\"devicemotion\", () => {\r\n                    if (Date.now() - time >= 300) {\r\n                        time = Date.now();\r\n                        if (false === flag) {\r\n                            wx.stopSearchBeacons({\r\n                                complete: () => {\r\n                                    console.log(\"启动蓝牙搜索\");\r\n                                    ibeaconArr = [];\r\n                                    this.searchIbeacon();\r\n                                },\r\n                                fail: (err) => {\r\n                                    console.log(\"stop fail\", err);\r\n                                }\r\n                            });\r\n                        }\r\n                        flag = true;\r\n                        timeId && clearTimeout(timeId);\r\n                        timeId = setTimeout(() => {\r\n                            flag = false;\r\n                            wx.stopSearchBeacons();\r\n                        }, 500);\r\n                    }\r\n                });\r\n\r\n                if (!this.initGps) {\r\n                    this.onSearchBeaconsWithGps();\r\n                } else {\r\n                    this.onSearchBeaconsWithGps();\r\n                }\r\n            });\r\n        }\r\n\r\n        /**\r\n         * @author j_bleach\r\n         * @date 2018-10-16\r\n         * @Description: 搜索蓝牙点\r\n         */\r\n        searchIbeacon() {\r\n            wx.startSearchBeacons({\r\n                ticket: \"\",\r\n                complete: (t) => {\r\n                    this.startSuccess({code: 0, msg: `室内定位启动，${t.errMsg}`});\r\n                    let n = t.errMsg;\r\n                    if (\"startSearchBeacons:already started\" === n) {\r\n                        return wx.stopSearchBeacons(() => {\r\n                            this.searchIbeacon();\r\n                        });\r\n                    }\r\n                    if (\"startSearchBeacons:system unsupported\" === n) {\r\n                        this.searchIbeacon();\r\n                    }\r\n                    \"startSearchBeacons:bluetooth power off\" === n\r\n                        ? this.startLocationError(\"蓝牙未打开\")\r\n                        : \"startSearchBeacons:location service disable\" === n && this.startLocationError(\"地理位置服务未打开\");\r\n                },\r\n                fail: (t) => {\r\n                    console.log(\"sdk-开启失败\", t);\r\n                }\r\n            });\r\n        }\r\n\r\n        /**\r\n         * @author j_bleach\r\n         * @date 2018-10-17\r\n         * @Description: 监听蓝牙点\r\n         */\r\n        onSearchBeacons() {\r\n            wx.onSearchBeacons({ //监听iBeacon设备更新事件\r\n                complete: (data) => {\r\n                    this.getIbeaconPoints(data);\r\n                }\r\n            });\r\n        }\r\n\r\n        /**\r\n         * @author j_bleach\r\n         * @date 2018-10-18\r\n         * @Description: 监听蓝牙点（超时切换gps）\r\n         */\r\n        onSearchBeaconsWithGps() {\r\n            console.log(\"进入蓝牙定时搜索\");\r\n            wx.onSearchBeacons({ //监听iBeacon设备更新事件\r\n                complete: (data) => {\r\n                    data.beacons = data.beacons && data.beacons.filter(v => (v.rssi != 0 && v.rssi > -90));\r\n                    if (data.beacons && data.beacons.length > 0) {\r\n                        this.currentLocation = \"ibeacon\";\r\n                        this.getIbeaconPoints(data);\r\n                        gpsTimeId && clearTimeout(gpsTimeId);\r\n                        gpsTimeId = setTimeout(() => {\r\n                            console.log(\"定时器执行\");\r\n                            ibeaconArr = [];\r\n                            this.currentLocation = \"gps\";\r\n                        }, CHANGE_GPS);\r\n                    }\r\n                },\r\n                fail: (err) => {\r\n                    console.log(\"蓝牙扫描失败\", err);\r\n                }\r\n            });\r\n        }\r\n\r\n        /**\r\n         * @author j_bleach\r\n         * @date 2018-10-17\r\n         * @Description: 获取蓝牙点\r\n         */\r\n        getIbeaconPoints(data) {\r\n            let filterData = data.beacons && data.beacons\r\n                .map(v => {\r\n                    return {rssi: ~~Number(v.rssi), device: `${v.major}_${v.minor}`};\r\n                });\r\n            if (filterData.length === 0) {\r\n                // this.onSuccess();\r\n            } else {\r\n                filterData = JSON.stringify([filterData]);\r\n                const getIbeaconBody = `mapId=${this.mapId}&datajson=${filterData}\r\n            &interval=${INTERVAL}&type=wx_${phoneType}`;\r\n                // console.log(\"请求\", getIbeaconBody);\r\n                fetch(getIbeconUrl, {\r\n                    method: \"PUT\",\r\n                    headers: {\r\n                        \"Content-Type\": \"application/x-www-form-urlencoded\"\r\n                    },\r\n                    body: getIbeaconBody\r\n                }).then((response) => response.json()).then((data) => {\r\n                    if (data.code == 0) {\r\n                        const res = data.data;\r\n                        const Polygon = this.setPolygonLocation(res);\r\n                        const ibeaconObj = {\r\n                            isOutdoor: 0,\r\n                            longitude: res.lon,\r\n                            latitude: res.lat,\r\n                            buildingId: res.building,\r\n                            level: res.level,\r\n                            fiducialLat: res.fiducialLat,\r\n                            fiducialLon: res.fiducialLon,\r\n                            locType: \"ibeacon\",\r\n                            timer: new Date().getTime(),\r\n                            ...Polygon\r\n                        };\r\n                        this.onSuccessIbeacon(ibeaconObj);\r\n                    }\r\n                }).catch((err) => {\r\n                    // this.initError(err);\r\n                    console.log(\"失败\", err);\r\n                });\r\n            }\r\n        }\r\n\r\n        /**\r\n         * @author j_bleach\r\n         * @date 2018-10-17\r\n         * @Description: 计算质心点\r\n         * @param data:array\r\n         * @return Polygon:obj\r\n         */\r\n        setPolygonLocation(data) {\r\n            if (ibeaconArr.length < POINTLENTH) {\r\n                ibeaconArr.push(data);\r\n                return {\r\n                    polygonLon: 0,\r\n                    polygonLat: 0\r\n                };\r\n            } else {\r\n                ibeaconArr.push(data);\r\n                const inputArr = ibeaconArr && ibeaconArr.map((v, i) => {\r\n                    return {...v, timestamp: new Date().getTime() + i * 2000};\r\n                });\r\n                const polygonLocation = this.polygonV2(inputArr);\r\n                ibeaconArr.shift();\r\n                return polygonLocation;\r\n            }\r\n        }\r\n\r\n        /**\r\n         * @author j_bleach\r\n         * @date 2018-08-23\r\n         * @Description: 更新质心点算法 polygonV2\r\n         * @param points:Array\r\n         */\r\n        polygonV2(points) {\r\n            let m = 0, x = 0, y = 0;\r\n            for (let i = 0; i < points.length; i++) {\r\n                m += points[i].timestamp;\r\n                x += (points[i].lon * points[i].timestamp);\r\n                y += (points[i].lat * points[i].timestamp);\r\n            }\r\n            return {polygonLon: x / m, polygonLat: y / m};\r\n        }\r\n    };\r\n};\r\n\r\nexport default blueToothFn;\r\n","/**\r\n * Created by j_bleach on 2018/10/16 0016.\r\n */\r\nconst gpsFn = (target) => {\r\n    return class gps extends target {\r\n        static gpsWatchId = null;\r\n\r\n        constructor() {\r\n            super();\r\n        }\r\n\r\n        checkGPS() {\r\n            if (\"geolocation\" in navigator) {\r\n                /* 地理位置服务可用 */\r\n                this.initGps = true;\r\n                this.initSuccess();\r\n            } else {\r\n                /* 地理位置服务不可用 */\r\n            }\r\n        }\r\n\r\n        geo_success = (res) => {\r\n            const data = res.coords;\r\n            const gpsObj = {\r\n                isOutdoor: 1,\r\n                longitude: data.longitude,\r\n                latitude: data.latitude,\r\n                accuracy: data.accuracy,\r\n                level: \"0\",\r\n                locType: \"gps\",\r\n                timestamp: res.timestamp,\r\n                // timer: new Date().getTime(),\r\n            };\r\n            this.onSuccessGps(gpsObj);\r\n        };\r\n\r\n        static geo_error(err) {\r\n            throw err;\r\n        }\r\n\r\n        startGpsSearch() {\r\n            console.log(\"进入gps\");\r\n            this.startSuccess({code: 1, msg: \"gps定位启动\"});\r\n            gps.gpsWatchId = navigator.geolocation.watchPosition(this.geo_success, gps.geo_error, {\r\n                enableHighAccuracy: true,\r\n                timeout: this.timeout\r\n            });\r\n        }\r\n\r\n        stopGpsSearch() {\r\n            console.log(\"停止gps\");\r\n            navigator.geolocation.clearWatch(gps.gpsWatchId);\r\n            this.stopLocationComplete({code: 1, msg: \"gps定位停止\"});\r\n        }\r\n    };\r\n};\r\n\r\nexport default gpsFn;\r\n","/**\r\n * Created by j_bleach on 2018/10/16 0016.\r\n */\r\nimport loc from \"./loc\";\r\n\r\nexport default loc;","/**\r\n * Created by j_bleach on 2018/10/16 0016.\r\n */\r\n/*eslint-disable*/\r\nimport bluetooth from \"./bluetooth\";\r\nimport gps from \"./gps\";\r\n\r\n@gps\r\n@bluetooth\r\nclass Loc {\r\n    /**\r\n     * @author j_bleach\r\n     * @date 2018-10-15\r\n     * @Description: 定位初始化\r\n     * @param timeout:number 超时时间，默认无穷大\r\n     * @param locType:string[] 定位类型\r\n     * @param complete:fn 成功回调\r\n     * @param error:fn 失败回调\r\n     * @return void\r\n     */\r\n    initIbeacon = false;\r\n    initGps = false;\r\n    ibeaconCoords = null;\r\n    gpsCoords = null;\r\n    locType = [];\r\n    currentPosition = null;\r\n    currentLocation = \"gps\";\r\n\r\n\r\n    init({\r\n             timeout,\r\n             locType,\r\n             mapId,\r\n             complete = () => {\r\n             },\r\n             error = () => {\r\n             }\r\n         }) {\r\n        console.log(\"开始定位\");\r\n        this.mapId = mapId;\r\n        this.timeout = timeout; // 超时时间\r\n        this.locType = locType; // 定位类型\r\n        this.initComplete = complete; // 初始化成功函数\r\n        this.initError = error; // 初始化失败函数\r\n        // locType && locType.includes(\"gps\") && this.checkGPS();\r\n        locType && locType.includes(\"ibeacon\") && this.getSignature();\r\n    }\r\n\r\n    initSuccess() {\r\n        if (this.locType.includes(\"ibeacon\") && this.initIbeacon) {\r\n            this.initComplete();\r\n        }\r\n    }\r\n\r\n    // 开启定位\r\n    startLocation({\r\n                      complete = () => {\r\n                      },\r\n                      error = () => {\r\n                      }\r\n                  }) {\r\n        this.startLocationComplete = complete;\r\n        this.startLocationError = error;\r\n        this.locType && this.locType.includes(\"gps\") && this.startGpsSearch();\r\n        this.locType && this.locType.includes(\"ibeacon\") && this.startIbeaconSearch();\r\n    }\r\n\r\n    // 开启成功\r\n    startSuccess(response) {\r\n        this.startLocationComplete(response);\r\n    }\r\n\r\n    // 停止定位\r\n    stopLocation(\r\n        {\r\n            complete = () => {\r\n            },\r\n            error = () => {\r\n            }\r\n        }\r\n    ) {\r\n        this.stopLocationComplete = complete;\r\n        this.locType && this.locType.includes(\"gps\") && this.stopGpsSearch();\r\n        this.locType && this.locType.includes(\"ibeacon\") && this.stopIbeaconSearch();\r\n    }\r\n\r\n    // 监听定位\r\n    onLocation(\r\n        {\r\n            complete = () => {\r\n            },\r\n            error = () => {\r\n            }\r\n        }\r\n    ) {\r\n        this.onLocationComplete = complete;\r\n    }\r\n\r\n    onSuccessGps(data) {\r\n        this.gpsCoords = data;\r\n        if (this.currentLocation !== \"ibeacon\") {\r\n            this.onLocationComplete(this.gpsCoords);\r\n            this.currentPosition = data;\r\n        }\r\n    }\r\n\r\n    onSuccessIbeacon(data) {\r\n        this.ibeaconCoords = data;\r\n        this.currentPosition = data;\r\n        this.onLocationComplete(this.ibeaconCoords, this);\r\n    }\r\n}\r\n\r\nexport default new Loc();\r\n"],"sourceRoot":""}