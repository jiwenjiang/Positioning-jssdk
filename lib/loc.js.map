{"version":3,"sources":["webpack://loc/webpack/universalModuleDefinition","webpack://loc/webpack/bootstrap","webpack://loc/./src/bluetooth/index.js","webpack://loc/./src/gps/index.js","webpack://loc/./src/index.js","webpack://loc/./src/loc.js"],"names":["INTERVAL","POINTLENTH","CHANGE_GPS","blueToothFn","target","phoneType","ibeaconArr","gpsTimeId","ua","navigator","userAgent","toLowerCase","test","signBody","encodeURIComponent","window","location","href","split","mapId","onunload","wx","stopSearchBeacons","signUrl","requestUrl","fetch","method","headers","body","then","response","json","data","configWx","initIbeacon","initSuccess","catch","err","initError","sign","config","debug","appId","appid","timestamp","nonceStr","signature","beta","jsApiList","error","res","complete","console","log","stopLocationComplete","code","msg","ready","time","flag","timeId","addEventListener","Date","now","searchIbeacon","fail","clearTimeout","setTimeout","initGps","onSearchBeaconsWithGps","startSearchBeacons","ticket","t","startSuccess","errMsg","n","startLocationError","onSearchBeacons","getIbeaconPoints","beacons","filter","v","rssi","length","currentLocation","filterData","map","Number","device","major","minor","JSON","stringify","getIbeaconBody","getIbeconUrl","Polygon","setPolygonLocation","ibeaconObj","isOutdoor","longitude","lon","latitude","lat","buildingId","building","level","fiducialLat","fiducialLon","locType","timer","getTime","onSuccessIbeacon","push","polygonLon","polygonLat","inputArr","i","polygonLocation","polygonV2","shift","points","m","x","y","gpsFn","coords","gpsObj","accuracy","onSuccessGps","gps","gpsWatchId","geolocation","watchPosition","geo_success","geo_error","enableHighAccuracy","timeout","clearWatch","Loc","wxSDK","initComplete","includes","getSignature","startLocationComplete","startGpsSearch","startIbeaconSearch","stopGpsSearch","stopIbeaconSearch","onLocationComplete","gpsCoords","currentPosition","ibeaconCoords"],"mappings":"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","file":"loc.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"loc\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"loc\"] = factory();\n\telse\n\t\troot[\"loc\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","/**\n * Created by j_bleach on 2018/10/16 0016.\n */\n\nconst INTERVAL = 500; // 服务器时间间隔\nconst POINTLENTH = 3; // 质心点计算数组长度\nconst CHANGE_GPS = 5000; // 搜索不到蓝牙5000ms后，切换gps\n\nconst blueToothFn = (target) => {\n  // const deviceUrl = `https://xz.parkbobo.com/location/device/v1/getAll`;\n  let phoneType = \"ios\";\n  let ibeaconArr = []; // 蓝牙地位点集合\n  let gpsTimeId = null; // gps定时器标记\n  const ua = navigator.userAgent.toLowerCase();\n  if (/iphone|ipad|ipod/.test(ua)) {\n    phoneType = `ios`;\n  } else if (/android/.test(ua)) {\n    phoneType = `android`;\n  }\n\n  return class bluetooth extends target {\n    constructor() {\n      super();\n    }\n\n    getSignature() {\n      const signBody = `url=${encodeURIComponent(window.location.href.split(\"#\")[0])}&mapId=${this.mapId}`;\n      // const deviceBody = `mapId=${this.mapId}&isElevator=1`;\n      // 注销页面，停止微信\n      window.onunload = () => {\n        this.wx.stopSearchBeacons();\n      };\n      // 请求签名\n      const signUrl = `${this.requestUrl}/wxConfig/weixin/v1/jsSdkSign`;\n      fetch(signUrl, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/x-www-form-urlencoded\"\n        },\n        body: signBody\n      }).then((response) => response.json()).then((data) => {\n\n        this.configWx(data.data);\n        this.initIbeacon = true;\n        this.initSuccess();\n      }).catch((err) => {\n        this.initError(err);\n      });\n\n      // fetch(deviceUrl, {\n      //     method: \"PUT\",\n      //     headers: {\n      //         \"Content-Type\": \"application/x-www-form-urlencoded\",\n      //     },\n      //     body: deviceBody\n      // }).then((response) => response.json()).then((data) => {\n      //     const arr = data.data;\n      //     this.elevators = arr && arr.map(v => v.device);\n      // }).catch((err) => {\n      //     this.initError(err);\n      // });\n    }\n\n    // 配置微信\n    configWx(sign) {\n      this.wx.config({\n        debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。\n        appId: sign.appid, // 必填，公众号的唯一标识\n        timestamp: sign.timestamp, // 必填，生成签名的时间戳\n        nonceStr: sign.nonceStr, // 必填，生成签名的随机串\n        signature: sign.signature,// 必填，签名\n        beta: true,   //用于在页面加载之初调用JSAPI\n        jsApiList: [\"openWXDeviceLib\", \"closeWXDeviceLib\",\n          \"onWXDeviceBluetoothStateChange\", \"startSearchBeacons\",\n          \"stopSearchBeacons\", \"onSearchBeacons\", \"startRecord\", \"stopRecord\",\n          \"translateVoice\", \"onMenuShareAppMessage\", \"getLocation\",\n          \"openBluetoothAdapter\", \"onBeaconServiceChange\", \"onWXDeviceBluetoothStateChange\",\n          \"getBluetoothAdapterState\", \"onBluetoothAdapterStateChange\"] // 必填，需要使用的JS接口列表\n      });\n      this.wx.error((res) => {\n        this.initError(res);\n      });\n    }\n\n    stopIbeaconSearch() {\n      this.wx.stopSearchBeacons({\n        complete: () => {\n          console.log(\"停止蓝牙\");\n          this.stopLocationComplete({code: 0, msg: \"蓝牙停止\"});\n        }\n      });\n    }\n\n    /**\n     * @author j_bleach\n     * @date 2018-10-16\n     * @Description: 开始搜索\n     */\n    startIbeaconSearch() {\n      console.log(\"进入蓝牙\");\n      this.wx.ready(() => {\n        let time = 0;\n        let flag = false;\n        let timeId = void 0;\n        window.addEventListener(\"devicemotion\", () => {\n          if (Date.now() - time >= 300) {\n            time = Date.now();\n            if (false === flag) {\n              this.wx.stopSearchBeacons({\n                complete: () => {\n                  console.log(\"启动蓝牙搜索\");\n                  ibeaconArr = [];\n                  this.searchIbeacon();\n                },\n                fail: (err) => {\n                  console.log(\"stop fail\", err);\n                }\n              });\n            }\n            flag = true;\n            timeId && clearTimeout(timeId);\n            timeId = setTimeout(() => {\n              flag = false;\n              this.wx.stopSearchBeacons();\n            }, 500);\n          }\n        });\n\n        if (!this.initGps) {\n          this.onSearchBeaconsWithGps();\n        } else {\n          this.onSearchBeaconsWithGps();\n        }\n      });\n    }\n\n    /**\n     * @author j_bleach\n     * @date 2018-10-16\n     * @Description: 搜索蓝牙点\n     */\n    searchIbeacon() {\n      this.wx.startSearchBeacons({\n        ticket: \"\",\n        complete: (t) => {\n          this.startSuccess({code: 0, msg: `室内定位启动，${t.errMsg}`});\n          let n = t.errMsg;\n          if (\"startSearchBeacons:already started\" === n) {\n            return this.wx.stopSearchBeacons(() => {\n              this.searchIbeacon();\n            });\n          }\n          if (\"startSearchBeacons:system unsupported\" === n) {\n            this.searchIbeacon();\n          }\n          \"startSearchBeacons:bluetooth power off\" === n\n            ? this.startLocationError(\"蓝牙未打开\")\n            : \"startSearchBeacons:location service disable\" === n && this.startLocationError(\"地理位置服务未打开\");\n        },\n        fail: (t) => {\n          console.log(\"sdk-开启失败\", t);\n        }\n      });\n    }\n\n    /**\n     * @author j_bleach\n     * @date 2018-10-17\n     * @Description: 监听蓝牙点\n     */\n    onSearchBeacons() {\n      this.wx.onSearchBeacons({ //监听iBeacon设备更新事件\n        complete: (data) => {\n          this.getIbeaconPoints(data);\n        }\n      });\n    }\n\n    /**\n     * @author j_bleach\n     * @date 2018-10-18\n     * @Description: 监听蓝牙点（超时切换gps）\n     */\n    onSearchBeaconsWithGps() {\n      console.log(\"进入蓝牙定时搜索\");\n      this.wx.onSearchBeacons({ //监听iBeacon设备更新事件\n        complete: (data) => {\n          data.beacons = data.beacons && data.beacons.filter(v => (v.rssi != 0 && v.rssi > -90));\n          if (data.beacons && data.beacons.length > 0) {\n            this.currentLocation = \"ibeacon\";\n            this.getIbeaconPoints(data);\n            gpsTimeId && clearTimeout(gpsTimeId);\n            gpsTimeId = setTimeout(() => {\n              console.log(\"定时器执行\");\n              ibeaconArr = [];\n              this.currentLocation = \"gps\";\n            }, CHANGE_GPS);\n          }\n        },\n        fail: (err) => {\n          console.log(\"蓝牙扫描失败\", err);\n        }\n      });\n    }\n\n    /**\n     * @author j_bleach\n     * @date 2018-10-17\n     * @Description: 获取蓝牙点\n     */\n    getIbeaconPoints(data) {\n      let filterData = data.beacons && data.beacons\n        .map(v => {\n          return {rssi: ~~Number(v.rssi), device: `${v.major}_${v.minor}`};\n        });\n      if (filterData.length === 0) {\n        // this.onSuccess();\n      } else {\n        filterData = JSON.stringify([filterData]);\n        const getIbeaconBody = `mapId=${this.mapId}&datajson=${filterData}\n            &interval=${INTERVAL}&type=wx_${phoneType}`;\n        // console.log(\"请求\", getIbeaconBody);\n        const getIbeconUrl = `${this.requestUrl}/location/weka/v1/classify`;// map\n        fetch(getIbeconUrl, {\n          method: \"PUT\",\n          headers: {\n            \"Content-Type\": \"application/x-www-form-urlencoded\"\n          },\n          body: getIbeaconBody\n        }).then((response) => response.json()).then((data) => {\n          if (data.code == 0) {\n            const res = data.data;\n            const Polygon = this.setPolygonLocation(res);\n            const ibeaconObj = {\n              isOutdoor: 0,\n              longitude: res.lon,\n              latitude: res.lat,\n              buildingId: res.building,\n              level: res.level,\n              fiducialLat: res.fiducialLat,\n              fiducialLon: res.fiducialLon,\n              locType: \"ibeacon\",\n              timer: new Date().getTime(),\n              ...Polygon\n            };\n            this.onSuccessIbeacon(ibeaconObj);\n          }\n        }).catch((err) => {\n          // this.initError(err);\n          console.log(\"失败\", err);\n        });\n      }\n    }\n\n    /**\n     * @author j_bleach\n     * @date 2018-10-17\n     * @Description: 计算质心点\n     * @param data:array\n     * @return Polygon:obj\n     */\n    setPolygonLocation(data) {\n      if (ibeaconArr.length < POINTLENTH) {\n        ibeaconArr.push(data);\n        return {\n          polygonLon: 0,\n          polygonLat: 0\n        };\n      } else {\n        ibeaconArr.push(data);\n        const inputArr = ibeaconArr && ibeaconArr.map((v, i) => {\n          return {...v, timestamp: new Date().getTime() + i * 2000};\n        });\n        const polygonLocation = this.polygonV2(inputArr);\n        ibeaconArr.shift();\n        return polygonLocation;\n      }\n    }\n\n    /**\n     * @author j_bleach\n     * @date 2018-08-23\n     * @Description: 更新质心点算法 polygonV2\n     * @param points:Array\n     */\n    polygonV2(points) {\n      let m = 0, x = 0, y = 0;\n      for (let i = 0; i < points.length; i++) {\n        m += points[i].timestamp;\n        x += (points[i].lon * points[i].timestamp);\n        y += (points[i].lat * points[i].timestamp);\n      }\n      return {polygonLon: x / m, polygonLat: y / m};\n    }\n  };\n};\n\nexport default blueToothFn;\n","/**\r\n * Created by j_bleach on 2018/10/16 0016.\r\n */\r\nconst gpsFn = (target) => {\r\n    return class gps extends target {\r\n        static gpsWatchId = null;\r\n\r\n        constructor() {\r\n            super();\r\n        }\r\n\r\n        checkGPS() {\r\n            if (\"geolocation\" in navigator) {\r\n                /* 地理位置服务可用 */\r\n                this.initGps = true;\r\n                this.initSuccess();\r\n            } else {\r\n                /* 地理位置服务不可用 */\r\n            }\r\n        }\r\n\r\n        geo_success = (res) => {\r\n            const data = res.coords;\r\n            const gpsObj = {\r\n                isOutdoor: 1,\r\n                longitude: data.longitude,\r\n                latitude: data.latitude,\r\n                accuracy: data.accuracy,\r\n                level: \"0\",\r\n                locType: \"gps\",\r\n                timestamp: res.timestamp,\r\n                // timer: new Date().getTime(),\r\n            };\r\n            this.onSuccessGps(gpsObj);\r\n        };\r\n\r\n        static geo_error(err) {\r\n            throw err;\r\n        }\r\n\r\n        startGpsSearch() {\r\n            console.log(\"进入gps\");\r\n            this.startSuccess({code: 1, msg: \"gps定位启动\"});\r\n            gps.gpsWatchId = navigator.geolocation.watchPosition(this.geo_success, gps.geo_error, {\r\n                enableHighAccuracy: true,\r\n                timeout: this.timeout\r\n            });\r\n        }\r\n\r\n        stopGpsSearch() {\r\n            console.log(\"停止gps\");\r\n            navigator.geolocation.clearWatch(gps.gpsWatchId);\r\n            this.stopLocationComplete({code: 1, msg: \"gps定位停止\"});\r\n        }\r\n    };\r\n};\r\n\r\nexport default gpsFn;\r\n","/**\r\n * Created by j_bleach on 2018/10/16 0016.\r\n */\r\nimport loc from \"./loc\";\r\n\r\nexport default loc;","/**\n * Created by j_bleach on 2018/10/16 0016.\n */\n/*eslint-disable*/\nimport bluetooth from \"./bluetooth\";\nimport gps from \"./gps\";\n\n@gps\n@bluetooth\nclass Loc {\n  /**\n   * @author j_bleach\n   * @date 2018-10-15\n   * @Description: 定位初始化\n   * @param timeout:number 超时时间，默认无穷大\n   * @param locType:string[] 定位类型\n   * @param complete:fn 成功回调\n   * @param error:fn 失败回调\n   * @return void\n   */\n  initIbeacon = false;\n  initGps = false;\n  ibeaconCoords = null;\n  gpsCoords = null;\n  locType = [];\n  currentPosition = null;\n  currentLocation = \"gps\";\n\n\n  init({\n         timeout,\n         locType,\n         mapId,\n         wxSDK,\n         requestUrl,\n         complete = () => {\n         },\n         error = () => {\n         }\n       }) {\n    console.log(\"开始定位\");\n    this.mapId = mapId;\n    this.timeout = timeout; // 超时时间\n    this.locType = locType; // 定位类型\n    this.initComplete = complete; // 初始化成功函数\n    this.initError = error; // 初始化失败函数\n    this.wx = wxSDK;\n    this.requestUrl = requestUrl;\n    // locType && locType.includes(\"gps\") && this.checkGPS();\n    locType && locType.includes(\"ibeacon\") && this.getSignature();\n  }\n\n  initSuccess() {\n    if (this.locType.includes(\"ibeacon\") && this.initIbeacon) {\n      this.initComplete();\n    }\n  }\n\n  // 开启定位\n  startLocation({\n                  complete = () => {\n                  },\n                  error = () => {\n                  }\n                }) {\n    this.startLocationComplete = complete;\n    this.startLocationError = error;\n    this.locType && this.locType.includes(\"gps\") && this.startGpsSearch();\n    this.locType && this.locType.includes(\"ibeacon\") && this.startIbeaconSearch();\n  }\n\n  // 开启成功\n  startSuccess(response) {\n    this.startLocationComplete(response);\n  }\n\n  // 停止定位\n  stopLocation(\n    {\n      complete = () => {\n      },\n      error = () => {\n      }\n    }\n  ) {\n    this.stopLocationComplete = complete;\n    this.locType && this.locType.includes(\"gps\") && this.stopGpsSearch();\n    this.locType && this.locType.includes(\"ibeacon\") && this.stopIbeaconSearch();\n  }\n\n  // 监听定位\n  onLocation(\n    {\n      complete = () => {\n      },\n      error = () => {\n      }\n    }\n  ) {\n    this.onLocationComplete = complete;\n  }\n\n  onSuccessGps(data) {\n    this.gpsCoords = data;\n    if (this.currentLocation !== \"ibeacon\") {\n      this.onLocationComplete(this.gpsCoords);\n      this.currentPosition = data;\n    }\n  }\n\n  onSuccessIbeacon(data) {\n    this.ibeaconCoords = data;\n    this.currentPosition = data;\n    this.onLocationComplete(this.ibeaconCoords, this);\n  }\n}\n\nexport default new Loc();\n"],"sourceRoot":""}